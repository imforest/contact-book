<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Contact</title>
	<link rel="stylesheet" href="/css/master.css">
</head>
<body>
	<nav>
		<h2>Contact Book</h2>
		<div>
			<ul>
				<li><a onclick="showElement('index')" href="#">Index</a></li>
				<li><a onclick="showElement('new')" href="#">New</a></li>
			</ul>
		</div>
	</nav>
	<section id="index" >
		<h2>Index</h2>
		<ul id="names"></ul>
	</section>
	<section id="new" style="display: none">
		<h2>New</h2>
		<form action="" method="">
			<div>
				<label for="name">Name</label>
				<input type="text" id="name">
			</div>
			<div>
				<label for="email">Email</label>
				<input type="text" id="email">
			</div>
			<div>
				<label for="phone">Phone</label>
				<input type="text" id="phone">
			</div>
			<div>
				<input type="button" value="Create" onclick="createContact()"></button>
			</div>
		</form>
	</section>
	<section id="edit" style="display: none">
		<h2>Edit</h2>
		<div id="editContent"><div>
	</section>
	<section id="show" style="display: none">
		<h2>Show</h2>
		<div id="showContent"><div>
	</section>

	<script>
	function setEventContactShow(elem) {
		elem.addEventListener('click', (e) => {
			hideElements('section');
			const elemShow = document.getElementById('show');
			elemShow.style.display = 'block'; 
			showContact(e.target.textContent);
		});
	}

	function setEventEdit(elem) {
		elem.addEventListener('click', (e) => {
			const elemContent = document.getElementById('editContent');
			elemContent.innerText = '';

			const name = document.getElementsByTagName('h3')[0].innerText;
			const h3 = document.createElement('h3');
			h3.innerText = name;
			elemContent.appendChild(h3);
			
			const contact = myContact.get(name);

			var label = document.createElement('label');
			label.innerText = 'Email';
			elemContent.appendChild(label);
			
			var input = document.createElement('input');
			input.value = contact.email
			elemContent.appendChild(input);
			elemContent.appendChild(document.createElement('br'));

			label = document.createElement('label');
			label.innerText = 'Phone';
			elemContent.appendChild(label);
			
			input = document.createElement('input');
			input.value = contact.phone
			elemContent.appendChild(input);
			elemContent.appendChild(document.createElement('br'));

			input = document.createElement('input');
			input.type = 'button';
			input.value = 'Save';
			elemContent.appendChild(input);
			elemContent.appendChild(document.createElement('br'));
			setEventSave(input);

			hideElements('section');
			const elemEdit = document.getElementById('edit');
			elemEdit.style.display = 'block';
			elemEdit.appendChild(elemContent);
		});
	}

	function setEventSave(elem) {
		elem.addEventListener('click', (e) => {
			const editContent = document.getElementById('editContent');
			const item = {
				name: editContent.getElementsByTagName('h3')[0].innerText,
				email: editContent.getElementsByTagName('input')[0].value,
				phone: editContent.getElementsByTagName('input')[1].value,
			}
			myContact.create(item);
			showContact(item.name);
		});
	}

	function showElement(eid) {
		const elem = document.getElementById(eid);

		if (!elem) {
			console.log('Not defined id: ' + eid);
		} else {
			hideElements('section');
			elem.style.display = 'block'; 
		}
	}

	function hideElements(tagName) {
		const elems = document.getElementsByTagName(tagName);
		for (let elem of elems) {
			elem.style.display = 'none';
		}
	}

	function showContact(name) {
		const contact = myContact.data.get(name);

		const elemContent = document.getElementById('showContent');
		elemContent.textContent = '';

		const h3 = document.createElement('h3');
		h3.innerText = contact.name;
		elemContent.appendChild(h3);

		var label = document.createElement('label');
		label.innerText = 'Email: ';
		elemContent.appendChild(label);
		
		var span = document.createElement('span');
		span.innerText = contact.email;
		elemContent.appendChild(span);
		elemContent.appendChild(document.createElement('br'));

		label = document.createElement('label');
		label.innerText = 'Phone: ';
		elemContent.appendChild(label);
		
		span = document.createElement('span');
		span.innerText = contact.phone;
		elemContent.appendChild(span);
		elemContent.appendChild(document.createElement('br'));

		var a = document.createElement('a');
		a.href = '#';
		a.text = 'Edit';
		elemContent.appendChild(a);
		setEventEdit(a);

		hideElements('section');
		const elemShow = document.getElementById('show');
		elemShow.style.display = 'block'; 
	}

	function createContact() {
		const item = {
			name: document.getElementById('name').value,
			email: document.getElementById('email').value,
			phone: document.getElementById('phone').value,
		}
		myContact.create(item);
		refreshContactElement();
	}

	function refreshContactElement() {
		const names = document.getElementById('names');
		names.querySelectorAll('*').forEach(name => name.remove());

		myContact.data.forEach((values) => {
				const newOne = createContactElement(values);
				const child = names.getElementsByTagName('li')[0];
				names.insertBefore(newOne, child);
		});

		showElement('index');
	}

	function createContactElement(item) {
		const li = document.createElement('li');
		const a = document.createElement('a');
		a.href = '#';
		a.text = item.name;
		li.appendChild(a);

		setEventContactShow(a);

		return li;
	}

	var ContactBook = function() {
		this.data = new Map();
	}

	ContactBook.prototype.create = function(item) {
		this.data.set(item.name, item);
	}

	ContactBook.prototype.get = function(name) {
		return this.data.get(name);
	}

	</script>

	<script>
		var myContact = new ContactBook();
	</script>

</body>
</html>
